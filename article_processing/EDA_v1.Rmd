---
title: "EDA_v1"
author: "Lasse Hyldig Hansen"
date: "2022-08-07"
output: html_document
output: 
  html_document:
    toc: true
---

```{r}
pacman::p_load(tidyverse, 
               stringr,
               ggpubr,
               lubridate, 
               Hmisc, 
               dplyr, 
               ggplot2, 
               maps, 
               rnaturalearth, 
               gganimate, 
               ggthemes,
               ggplot2, 
               hrbrthemes,
               viridis,
               googlesheets4,
               ggpmisc
               )
```

```{r}
articles_coded <- read_sheet("https://docs.google.com/spreadsheets/d/1Xufv1kIKV7AhOCPYXZ9HPFjeb5uUGh8Dm8Jd9zVNg2c/edit#gid=1728518595",
                             sheet = "EXTRACTION OF ARTICLE CODING ")

articles_coded = articles_coded %>% rename("year" = "Year")
```

### Year plot


```{r}
formula_plot = y ~ x 
articles_coded %>% 
                group_by(year) %>% 
                summarise(count = n()) %>%
                ggplot(., aes(x=year, y = count)) +
                geom_point() +#Setting aesthetics with month as a factor
                geom_smooth(method = "lm", se = T, #Making a linear line confidence intervals
                            color = "black", 
                            formula = formula_plot) + #Setting formula
                stat_poly_eq(formula = formula_plot, 
                              aes(label = paste(..eq.label.., ..rr.label.., #Making labels for model parameters
                              sep = "~~~")),  
                              parse = TRUE)
                theme_minimal() +             #Setting theme 
                xlab("Year") +               #Changing x label
                ylab("Publication Counts ")
```


```{r}
articles_coded %>% 
                group_by(year) %>% 
                summarise(count = n()) %>%
                ggplot(., aes(x=as.factor(year), y= count)) + #Setting aesthetics with month as a factor
                geom_bar(stat="identity", 
                         width=0.99,          #Setting width of bars
                         fill="steelblue") + #Setting color
                theme_minimal() +             #Setting theme 
                xlab("Year") +               #Changing x label
                ylab("Publication Counts ")
```

### definition implemented Plot

#### Getting unique definitions implemented

```{r}
unique(articles_coded$def_imp)
```

```{r}
articles_coded_long = 
    articles_coded %>%
    summarise(
    year = year,
    country = country,
    Embodiment = paste0(str_count(def_imp, "Embodiment")),
    "Emotional empathy" = paste0(str_count(def_imp, "Emotional empathy")),
    "Cognitive empathy" = paste0(str_count(def_imp, "Cognitive empathy")),
    "Social intelligence" = paste0(str_count(def_imp, "Social intelligence")),
    Imitation = paste0(str_count(def_imp, "Imitation")),
    Prosociality = paste0(str_count(def_imp, "Prosociality"))) %>% 
    pivot_longer(., 3:8)
```

```{r}
unique(articles_coded$def_imp)
```

```{r}
Application space x embodiment (Human robot)
Measurement method x study design (Human_Robot)
Study design x Empathy Implementation (Human Robot)
Empathy Domain x Approach 
```


```{r}
articles_coded_long = 
    articles_coded %>%
    summarise(
    year = year,
    def_imp = def_imp,
    robot = paste0(str_count(robot_human, "R")),
    human = paste0(str_count(robot_human, "h"))) %>% 
    pivot_longer(., 3:4) %>% 
    mutate(human_robot = ifelse(value == 1, name, NA)) %>% 
    drop_na() %>%
    select(1:2, 5) %>% 
    mutate(
    Embodiment = paste0(str_count(def_imp, "Embodiment")),
    "Emotional empathy" = paste0(str_count(def_imp, "Emotional empathy")),
    "Cognitive empathy" = paste0(str_count(def_imp, "Cognitive empathy")),
    "Social intelligence" = paste0(str_count(def_imp, "Social intelligence")),
    Imitation = paste0(str_count(def_imp, "Imitation")),
    Prosociality = paste0(str_count(def_imp, "Prosociality"))) %>%
    pivot_longer(., 4:9) %>%
    mutate(value = as.numeric(value)) %>% 
    group_by(name, human_robot) %>% 
    summarise(count = sum(value, na.rm = T)) %>% 
    arrange(desc(count)) %>% 
    rename("Study focus" = "human_robot")
    
articles_coded_long %>% 
    ggplot(., aes(x = reorder(name, +count), y = count, fill = `Study focus`)) + geom_col() + 
    coord_flip() +
    theme_light() +           
    ylab("Articles") + 
    scale_fill_manual(values=c("#BD8C58", "#597787")) +
    xlab("Country")
  
def_imp_count =  articles_coded_long %>% 
                      mutate(value = as.numeric(value)) %>%  
                      group_by(name) %>% 
                      summarise(count = sum(value, na.rm = T)) %>% 
                      arrange(desc(count))

def_imp_count %>%
  ggplot(., aes(x = reorder(name, +count), y = count, fill = count)) + geom_col(show.legend = FALSE) + 
  coord_flip() +
  theme_minimal() +           
  ylab("Count") + 
  xlab("Definition Implemented")
```

```{r}
unique(articles_coded$country)
```


```{r}
design_imp_long <- articles_coded %>% 
    summarise(
    year = year,
    country = country,
    def_imp = def_imp,
    Pain = paste0(str_count(study_design, "Pain")),
    Game = paste0(str_count(study_design, "game")),
    "Social Interaction" = paste0(str_count(study_design, "Social interaction")),
    "Machine Learning" = paste0(str_count(study_design, "Machine learning")),
    VR = paste0(str_count(study_design, "VR")),
    Chatbot = paste0(str_count(study_design, "Chatbot")),
    "Cognitive model" = paste0(str_count(study_design, "Cognitive model")),
    "Behaviour model" = paste0(str_count(study_design, "Behaviour model")),
    "Video stimuli" = paste0(str_count(study_design, "video")),
    "Photo stimuli" = paste0(str_count(study_design, "images"))
    ) %>% pivot_longer(., 4:13) %>% 
    mutate(study_design = ifelse(value == 1, name, NA)) %>% 
    drop_na() %>% 
    select(1:3, 6) %>% 
    mutate(
    Embodiment = paste0(str_count(def_imp, "Embodiment")),
    "Emotional empathy" = paste0(str_count(def_imp, "Emotional empathy")),
    "Cognitive empathy" = paste0(str_count(def_imp, "Cognitive empathy")),
    "Social intelligence" = paste0(str_count(def_imp, "Social intelligence")),
    Imitation = paste0(str_count(def_imp, "Imitation")),
    Prosociality = paste0(str_count(def_imp, "prosociality")),
    "NLP" = paste0(str_count(def_imp, "NLP"))) %>%
    pivot_longer(., 5:11) %>%
    mutate(value = as.numeric(value)) %>%  
    group_by(name, study_design) %>% 
    summarise(count = sum(value, na.rm = T)) %>% 
    arrange(desc(count)) %>% 
    rename("Study Design" = "study_design")

design_imp_long %>%
  ggplot(., aes(x = reorder(name, +count), y = count, fill = `Study Design`)) + geom_col() + 
  coord_flip() +
  theme_minimal() +           
  ylab("Articles") + 
  scale_fill_manual(values=c("#597787", "#649079", "#8BBBA2", "#8DA185", "#8E8767", "#9B7E46", "#C89856", "#BD8C58", "#CDA982", "#DDC4A9")) +
  xlab("Empathy Definition")

```

### Empaty domain Plot

#### Getting unique empathy domain categories

```{r}
unique(articles_coded$emp_dom)
```

```{r Empaty domain Plot}
emp_dom_long = 
    articles_coded %>%
    summarise(
    year = year,
    citations = Citations,
    country = country,
    title = Title, 
    "Embodied cues" = paste0(str_count(emp_dom, "Embodied cues")),
    Language = paste0(str_count(emp_dom, "Language")),
    "Social behavior" = paste0(str_count(emp_dom, "Social behaviour")),
    "Facial expression" = paste0(str_count(emp_dom, "Facial expression")),
    Embodiment = paste0(str_count(emp_dom, "Embodiment")),
    Prosociality = paste0(str_count(emp_dom, "Prosociality"))) %>% pivot_longer(., 5:10)

emp_dom_count =  emp_dom_long %>% 
                      mutate(value = as.numeric(value)) %>%  
                      group_by(name) %>% 
                      summarise(count = sum(value, na.rm = T),
                                citations = mean(citations, na.rm = T)) %>% 
                      arrange(desc(count))

### FORSØG; IKKE FÆRDIGT; 

emp_dom_title_c =  emp_dom_long %>% 
                      mutate(value = as.numeric(value)) %>%  
                      group_by(title) %>% 
                      summarise(
                                name = name,
                                count = sum(value, na.rm = T),
                                citations = mean(citations, na.rm = T)) %>% 
                      arrange(desc(count))

## DENNE ER FÆRDIG 


emp_dom_count %>%
  ggplot(., aes(x = reorder(name, +count), y = count, fill = count)) + geom_col(show.legend = FALSE) + 
  coord_flip() +
  theme_minimal() +           
  ylab("Articles") + 
  xlab("Empathy Domain")


### FORSØG; IKKE FÆRDIGT; 

emp_dom_count %>%
  ggplot(., aes(x = citations, y = count, fill = name)) +
  geom_point(alpha=0.7) +
  geom_line() + 
  scale_colour_manual(values=c("#597787", "#649079", "#8DA185", "#9B7E46", "#BD8C58", "#DDC4A9")) + 
  theme_light()
  theme_minimal() +           
  ylab("Articles") + 
  xlab("Empathy Domain")
  

```
```{r}
emp_dom_count
```

### Empathy domain per Country plot

```{r Empathy domain per Country plot}
Emp_dom_Per_Country <- articles_coded %>%
      summarise(
      year = year,
      country = country,
      "Embodied cues" = paste0(str_count(emp_dom, "Embodied cues")),
       Language = paste0(str_count(emp_dom, "Language")),
      "Social behavior" = paste0(str_count(emp_dom, "Social behavior")),
      "Facial expression" = paste0(str_count(emp_dom, "Facial expression")),
      Embodiment = paste0(str_count(emp_dom, "Embodiment")),
      Prosociality = paste0(str_count(emp_dom, "Prosociality"))) %>% 
      pivot_longer(., 3:8) %>% 
      mutate(emp_dom = ifelse(value == 1, name, NA)) %>% 
      drop_na() %>% 
      select(1:2, 5) %>% 
      mutate(
      ID = paste0(str_count(country, "ID")),
      PT = paste0(str_count(country, "PT")),
      CN = paste0(str_count(country, "CN")),
      UK = paste0(str_count(country, "UK")),
      DE = paste0(str_count(country, "DE")),
      US = paste0(str_count(country, "US")),
      IR = paste0(str_count(country, "IR")),
      MX = paste0(str_count(country, "MX")),
      HK = paste0(str_count(country, "HK")),
      ES = paste0(str_count(country, "ES")),
      IT = paste0(str_count(country, "IT")),
      EU = paste0(str_count(country, "EU")),
      IL = paste0(str_count(country, "IL")),
      CH = paste0(str_count(country, "CH")),
      NZ = paste0(str_count(country, "NZ")),
      PL = paste0(str_count(country, "PL")),
      FR = paste0(str_count(country, "FR")),
      TH = paste0(str_count(country, "TH")),
      SE = paste0(str_count(country, "SE")),
      SA = paste0(str_count(country, "SA")),
      PK = paste0(str_count(country, "PK")),
      BR = paste0(str_count(country, "BR")),
      MY = paste0(str_count(country, "MY")),
      AU = paste0(str_count(country, "AU")),
      JP = paste0(str_count(country, "JP")),
      BE = paste0(str_count(country, "BE")),
      NL = paste0(str_count(country, "NL")),
      KR = paste0(str_count(country, "KR")),
      SG = paste0(str_count(country, "SG")),
      SK = paste0(str_count(country, "SK")),
      TR = paste0(str_count(country, "TR")),
      CA = paste0(str_count(country, "CA")),
      IN = paste0(str_count(country, "IN")),
      PT = paste0(str_count(country, "BE")),
      RO = paste0(str_count(country, "RO")),
      IE = paste0(str_count(country, "IE")),
      TW = paste0(str_count(country, "TW")),
      DK = paste0(str_count(country, "DK")),
      GB = paste0(str_count(country, "GB"))) %>% 
      pivot_longer(., 4:41) %>% 
      mutate(value = as.numeric(value)) %>% 
      group_by(name, emp_dom) %>% 
      summarise(count = sum(value, na.rm = T)) %>% 
      arrange(desc(count)) %>% 
      rename("Empathy Domain" = "emp_dom")

Emp_dom_Per_Country %>% 
    ggplot(., aes(x = reorder(name, +count), y = count, fill = `Empathy Domain`)) + geom_col() + 
    coord_flip() +
    theme_minimal() +           
    ylab("Articles") + 
scale_fill_manual(values=c("#597787", "#649079", "#8BBBA2", "#8E8767", "#C89856", "#DDC4A9")) +    
   xlab("Country")
```


```{r Country - Human/Robot plot}

Countr_Human_Robot <- articles_coded %>% 
      summarise(
      year = year,
      country = country,
      robot = paste0(str_count(robot_human, "R")),
      human = paste0(str_count(robot_human, "h"))) %>% 
      pivot_longer(., 3:4) %>% 
      mutate(human_robot = ifelse(value == 1, name, NA)) %>% 
      drop_na() %>%
      select(1:2, 5) %>% 
      mutate(
      ID = paste0(str_count(country, "ID")),
      PT = paste0(str_count(country, "PT")),
      CN = paste0(str_count(country, "CN")),
      UK = paste0(str_count(country, "UK")),
      DE = paste0(str_count(country, "DE")),
      US = paste0(str_count(country, "US")),
      IR = paste0(str_count(country, "IR")),
      MX = paste0(str_count(country, "MX")),
      HK = paste0(str_count(country, "HK")),
      ES = paste0(str_count(country, "ES")),
      IT = paste0(str_count(country, "IT")),
      EU = paste0(str_count(country, "EU")),
      IL = paste0(str_count(country, "IL")),
      CH = paste0(str_count(country, "CH")),
      NZ = paste0(str_count(country, "NZ")),
      PL = paste0(str_count(country, "PL")),
      FR = paste0(str_count(country, "FR")),
      TH = paste0(str_count(country, "TH")),
      SE = paste0(str_count(country, "SE")),
      SA = paste0(str_count(country, "SA")),
      PK = paste0(str_count(country, "PK")),
      BR = paste0(str_count(country, "BR")),
      MY = paste0(str_count(country, "MY")),
      AU = paste0(str_count(country, "AU")),
      JP = paste0(str_count(country, "JP")),
      BE = paste0(str_count(country, "BE")),
      NL = paste0(str_count(country, "NL")),
      KR = paste0(str_count(country, "KR")),
      SG = paste0(str_count(country, "SG")),
      SK = paste0(str_count(country, "SK")),
      TR = paste0(str_count(country, "TR")),
      CA = paste0(str_count(country, "CA")),
      IN = paste0(str_count(country, "IN")),
      PT = paste0(str_count(country, "BE")),
      RO = paste0(str_count(country, "RO")),
      IE = paste0(str_count(country, "IE")),
      TW = paste0(str_count(country, "TW")),
      DK = paste0(str_count(country, "DK")),
      GB = paste0(str_count(country, "GB"))) %>% 
      pivot_longer(., 4:41) %>%
      mutate(value = as.numeric(value)) %>% 
      group_by(name, human_robot) %>% 
      summarise(count = sum(value, na.rm = T)) %>% 
      arrange(desc(count)) %>% 
      rename("Study focus" = "human_robot")

Countr_Human_Robot %>% 
    ggplot(., aes(x = reorder(name, +count), y = count, fill = `Study focus`)) + geom_col() + 
    coord_flip() +
    theme_light() +           
    ylab("Articles") + 
    scale_fill_manual(values=c("#BD8C58", "#597787")) +
    xlab("Country")



```

### Study Design Plot

#### Getting unique study design categories

```{r Getting unique study design categories}
unique(articles_coded$study_design)
```

```{r Study Design Plot}
articles_coded_long = 
    articles_coded %>%
    summarise(
    year = year,
    country = country,
    Pain = paste0(str_count(study_design, "Pain")),
    Game = paste0(str_count(study_design, "Game")),
    "Social Interaction" = paste0(str_count(study_design, "Social interaction")),
    "Machine Learning" = paste0(str_count(study_design, "Machine learning")),
    Visual = paste0(str_count(study_design, "Visual")),
    "Behaviour Model" = paste0(str_count(study_design, "Behaviour model"))) %>% 
    pivot_longer(., 3:8)

study_design_count =  articles_coded_long %>% 
                      mutate(value = as.numeric(value)) %>%  
                      group_by(name) %>% 
                      summarise(count = sum(value, na.rm = T)) %>% 
                      arrange(desc(count))

study_design_count %>%
  ggplot(., aes(x = reorder(name, +count), y = count, fill = count)) + geom_col(show.legend = FALSE) + 
  coord_flip() +
  theme_minimal() +           
  ylab("Count") + 
  xlab("Study Design")
  

```



```{r}
hr_studyDesign <- articles_coded %>% 
      summarise(
      year = year,
      country = country,
      study_design = study_design,
      Robot = paste0(str_count(robot_human, "R")),
      Human = paste0(str_count(robot_human, "h"))) %>%
      pivot_longer(., 4:5) %>% 
      mutate(robot_human = ifelse(value == 1, name, NA)) %>% 
      drop_na()
```

```{r}
theme_eai <- theme_classic() + theme(axis.text.y=element_blank(),
        panel.grid=element_blank(),
        axis.title.x=element_text(hjust=-0.15))

scale_fill_tableau()
```

## Application space x embodiment (Human robot)  - Plot 

```{r}
plot_dat_1 = 
    articles_coded %>%
    summarise(
    year = year,
    embodiment = embodiment,
    robot_human,
    "HRI" = paste0(str_count(app_space, "HRI")),
    "Human health" = paste0(str_count(app_space, "Human health")),
    "Computer Vision" = paste0(str_count(app_space, "Computer Vision")),
    "NLP" = paste0(str_count(app_space, "NLP")),
    "Human relations" = paste0(str_count(app_space, "Human relations")),
    Game = paste0(str_count(app_space, "Game")),
    VR = paste0(str_count(app_space, "VR")),
    "Customer Service" = paste0(str_count(app_space, "Customer Service"))
    ) %>% 
    pivot_longer(., 4:11) %>%
    mutate(app_space = ifelse(value == 1, name, NA)) %>% 
    drop_na() %>% 
    select(1:3, 6) %>% 
    mutate(
    Robot = paste0(str_count(embodiment, "Robot")),
    Text = paste0(str_count(embodiment, "Text")),
    "Physiology" = paste0(str_count(embodiment, "Physiology")),
    "Human behaviour" = paste0(str_count(embodiment, "Human behaviour")),
    GUI = paste0(str_count(embodiment, "GUI")),
    "Visual" = paste0(str_count(embodiment, "Visual"))) %>% 
    pivot_longer(., 5:10) %>%
    mutate(embodiment = ifelse(value == 1, name, NA)) %>% 
    drop_na() %>%
    select(1:4) %>% 
    mutate(
    Robot = paste0(str_count(robot_human, "R")),
    Human = paste0(str_count(robot_human, "h"))) %>%
    pivot_longer(., 5:6) %>% 
    mutate(robot_human = ifelse(value == 1, name, NA)) %>% 
    drop_na() %>%
    mutate(value = as.numeric(value)) %>% 
    group_by(app_space, embodiment, robot_human) %>% 
    summarise(count = sum(value, na.rm = T)) %>% 
    arrange(desc(count)) %>%
    rename("Study focus" = "robot_human") %>% 
    rename("Embodiment" = "embodiment") %>% 
    rename("Application Space" = "app_space")  

p1 <- plot_dat_1 %>% 
    ggplot(., aes(x = reorder(Embodiment, +count), y = count, fill = `Application Space`)) + 
    geom_col(width=1, color="#00000099") + 
    guides(fill=guide_legend(nrow=2, title.position = "top")) +
    coord_flip(expand = F, ylim=c(0,79)) + 
    #theme_eai +       
    scale_fill_tableau() + 
    #ylab("Empathy Definiton Implemented") + 
    #scale_fill_manual(values=c("#BD8C58", "#597787")) +
    xlab("Embodiment") +
    #coord_cartesian(expand = F) + 
    facet_wrap( ~ `Study focus`) +
    theme_light() +
  geom_hline(yintercept=0, color="#00000099") +
  labs(subtitle="Embodiment")
   
```

## Measurement method x study design (Human_Robot) - Plot 

```{r}
unique(articles_coded$measurement_method)
```


```{r}
plot_dat_2 = 
    articles_coded %>%
    summarise(
    year = year,
    study_design = study_design,
    robot_human,
    "Machine Learning" = paste0(str_count(measurement_method, "Machine learning")),
    "Physiological Behaviour" = paste0(str_count(measurement_method, "Physiological behaviour")),
    Interview = paste0(str_count(measurement_method, "Interview")),
    "Cognitive Test" = paste0(str_count(measurement_method, "Cognitive Test")),
    "Human Behvaiour" = paste0(str_count(measurement_method, "Human behaviour"))) %>% 
    pivot_longer(., 4:8) %>%
    mutate(measurement_method = ifelse(value == 1, name, NA)) %>% 
    drop_na() %>% 
    select(1:3, 6) %>% 
    mutate(
    Pain = paste0(str_count(study_design, "Pain")),
    Game = paste0(str_count(study_design, "Game")),
    "Social Interaction" = paste0(str_count(study_design, "Social interaction")),
    "Machine Learning" = paste0(str_count(study_design, "Machine learning")),
    Visual = paste0(str_count(study_design, "Visual")),
    "Behaviour Model" = paste0(str_count(study_design, "Behaviour model"))) %>% 
    pivot_longer(., 5:10) %>% 
    mutate(study_design = ifelse(value == 1, name, NA)) %>% 
    drop_na() %>% 
    select(1:4) %>% 
    mutate(
    Robot = paste0(str_count(robot_human, "R")),
    Human = paste0(str_count(robot_human, "h"))) %>%
    pivot_longer(., 5:6) %>% 
    mutate(robot_human = ifelse(value == 1, name, NA)) %>% 
    drop_na() %>%
    mutate(value = as.numeric(value)) %>% 
    group_by(study_design, measurement_method, robot_human) %>% 
    summarise(count = sum(value, na.rm = T)) %>% 
    arrange(desc(count)) %>%
    rename("Study focus" = "robot_human") %>% 
    rename("Measurement Method" = "measurement_method") %>% 
    rename("Study Design" = "study_design")  

p2 <- plot_dat_2 %>% 
    ggplot(., aes(x = reorder(`Measurement Method`, +count), y = count, fill = `Study Design`)) + 
    geom_col(width=1, color="#00000099") + 
    guides(fill=guide_legend(nrow=3, title.position = "top")) +
    coord_flip(expand = F, ylim=c(0,79)) + 
    #theme_eai +       
    scale_fill_tableau() + 
    #ylab("Empathy Definiton Implemented") + 
    #scale_fill_manual(values=c("#BD8C58", "#597787")) +
    xlab("Measurement Method") +
    #coord_cartesian(expand = F) + 
    facet_wrap( ~ `Study focus`) +
    theme_light() +
  geom_hline(yintercept=0, color="#00000099") +
  labs(subtitle="Measurement method")
   
```

## Empathy Domain x Approach (Human_Robot) - Plot

```{r}
plot_dat_3 = 
    articles_coded %>%
    summarise(
    year = year,
    approach = approach,
    robot_human,
    Language = paste0(str_count(emp_dom, "Language")),
    "Embodied cues" = paste0(str_count(emp_dom, "Embodied cues")),
    "Social behavior" = paste0(str_count(emp_dom, "Social behavior")),
    "Facial expression" = paste0(str_count(emp_dom, "Facial expression"))) %>% 
    pivot_longer(., 4:7) %>%
    mutate(emp_dom = ifelse(value == 1, name, NA)) %>% 
    drop_na() %>% 
    select(1:3, 6) %>%
    mutate(
    GOFAI = paste0(str_count(approach, "GOFAI")),
    Cognitive_model = paste0(str_count(approach, "Cognitive model")),
    Machine_learning = paste0(str_count(approach, "Machine learning")),
    Prerecorded = paste0(str_count(approach, "Prerecorded"))) %>% 
    pivot_longer(., 5:8) %>% 
    mutate(approach = ifelse(value == 1, name, NA)) %>% 
    drop_na() %>% 
    select(1:4) %>%   
    mutate(
    Robot = paste0(str_count(robot_human, "R")),
    Human = paste0(str_count(robot_human, "h"))) %>%
    pivot_longer(., 5:6) %>% 
    mutate(robot_human = ifelse(value == 1, name, NA)) %>% 
    drop_na() %>%
    mutate(value = as.numeric(value)) %>% 
    group_by(approach, emp_dom, robot_human) %>% 
    summarise(count = sum(value, na.rm = T)) %>% 
    arrange(desc(count)) %>%
    rename("Study focus" = "robot_human") %>% 
    rename("Empathy Domain" = "emp_dom") %>% 
    rename("Approach" = "approach")  

p3 <- plot_dat_3 %>% 
    ggplot(., aes(x = reorder(`Empathy Domain`, +count), y = count, fill = Approach)) + 
    geom_col(width=1, color="#00000099") + 
    guides(fill=guide_legend(nrow=2, title.position = "top")) +
    coord_flip(expand = F, ylim=c(0,79)) + 
    #theme_eai +       
    scale_fill_tableau() + 
    #ylab("Empathy Definiton Implemented") + 
    #scale_fill_manual(values=c("#BD8C58", "#597787")) +
    xlab("Empathy Domain") +
    #coord_cartesian(expand = F) + 
    facet_wrap( ~ `Study focus`) +
    theme_light() +
  geom_hline(yintercept=0, color="#00000099") +
  labs(subtitle="Empathy domain")
   
```

## Study design x Empathy Definition Implementation (Human Robot) - Plot

```{r}
plot_dat_4 = 
    articles_coded %>%
    summarise(
    year = year,
    def_imp = def_imp,
    robot_human,
    Pain = paste0(str_count(study_design, "Pain")),
    Game = paste0(str_count(study_design, "Game")),
    "Social Interaction" = paste0(str_count(study_design, "Social interaction")),
    "Machine Learning" = paste0(str_count(study_design, "Machine learning")),
    Visual = paste0(str_count(study_design, "Visual")),
    "Behaviour Model" = paste0(str_count(study_design, "Behaviour model"))) %>% 
    pivot_longer(., 4:9) %>% 
    mutate(study_design = ifelse(value == 1, name, NA)) %>% 
    drop_na() %>%
    select(1:3, 6) %>% 
    mutate(
    Embodiment = paste0(str_count(def_imp, "Embodiment")),
    "Emotional empathy" = paste0(str_count(def_imp, "Emotional empathy")),
    "Cognitive empathy" = paste0(str_count(def_imp, "Cognitive empathy")),
    "Social intelligence" = paste0(str_count(def_imp, "Social intelligence")),
    Imitation = paste0(str_count(def_imp, "Imitation")),
    Prosociality = paste0(str_count(def_imp, "Prosociality"))) %>% 
    pivot_longer(., 5:10) %>% 
    mutate(def_imp = ifelse(value == 1, name, NA)) %>% 
    drop_na() %>%
    select(1:4) %>%   
    mutate(
    Robot = paste0(str_count(robot_human, "R")),
    Human = paste0(str_count(robot_human, "h"))) %>%
    pivot_longer(., 5:6) %>% 
    mutate(robot_human = ifelse(value == 1, name, NA)) %>% 
    drop_na() %>%
    mutate(value = as.numeric(value)) %>% 
    group_by(def_imp, study_design, robot_human) %>% 
    summarise(count = sum(value, na.rm = T)) %>% 
    arrange(desc(count)) %>%
    rename("Study focus" = "robot_human") %>% 
    rename("Study design" = "study_design")

p4 <- plot_dat_4 %>% 
    ggplot(., aes(x = reorder(def_imp, +count), y = count, fill = `Study design`)) + 
    geom_col(width=1, color="#00000099") + 
    guides(fill=guide_legend(nrow=3, title.position = "top")) +
    coord_flip(expand = F, ylim=c(0,79)) + 
    #theme_eai +       
    scale_fill_tableau() + 
    theme_light() +
    #ylab("Empathy Definiton Implemented") + 
    #scale_fill_manual(values=c("#BD8C58", "#597787")) +
    xlab("Empathy Definiton Implemented") +
    #coord_cartesian(expand = F) + 
    facet_wrap( ~ `Study focus`) +
  geom_hline(yintercept=0, color="#00000099") +
  labs(subtitle="Definiton implemented")
```

## Putting the figures into 1 figure at last 

```{r main_annotation,fig.width=5, dpi=300, fig.height=3}
theme_update <- theme_minimal() +
  theme(
    legend.position="top",
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_blank(),
    axis.title.x = element_blank(),
    axis.line = element_line(color="#00000099"),
    panel.spacing=unit(0,"lines"),
    legend.key.size = unit(0.3, "cm"),
    legend.justification = "left",
    legend.margin = margin(0,0,0,0,"lines"),
    axis.title.y = element_blank(),
    plot.margin = margin(0,0,0,0,"pt")
  )

p1 <- p1 + theme_update + theme(plot.subtitle = element_text(hjust=-0.38, vjust=-30))
p2 <- p2 + theme_update + theme(plot.subtitle = element_text(hjust=-1.04, vjust=-40))
p3 <- p3 + theme_update + theme(plot.subtitle = element_text(hjust=-0.55, vjust=-30))
p4 <- p4 + theme_update + theme(plot.subtitle = element_text(hjust=-0.93, vjust=-40))
figure = ggarrange(p1, p2, p3, p4, ncol = 2, nrow = 2, common.legend = F) + theme(plot.margin = margin(0,0,0,20,"pt"))
ggsave("../figures/main_annotation.png", figure, units="in", dpi=300,width=9, height=4.5)
figure
```


```{r}
unique(articles_coded$Domain)
```

## Clustering visualization

```{r}
topic_counts <- articles_coded %>% 
                   group_by(Topic, year) %>% 
                   summarise(count = n()) 

ggplot(topic_counts, aes(fill=Topic, y=count, x=year)) + 
    geom_bar(position="stack", stat="identity") + 
    coord_flip() +
    scale_fill_tableau()


```


### Measurement method Plot

#### Getting unique measurement method categories

```{r Getting unique measurement method}
unique(articles_coded$measurement_method)
```

```{r Measurement method Plot}
meas_meth_long = 
    articles_coded %>%
    summarise(
    year = year,
    country = country,
    Embodied_cues = paste0(str_count(measurement_method, "Machine learning")),
    Language = paste0(str_count(measurement_method, "Questionnaire")),
    Soc_Behavior = paste0(str_count(measurement_method, "Interview")),
    Facial_expression = paste0(str_count(measurement_method, "behavior modelling")),
    Embodiment = paste0(str_count(measurement_method, "reaction time")),
    Prosociality = paste0(str_count(measurement_method, "Prosociality"))) %>% pivot_longer(., 3:8)

emp_dom_count =  emp_dom_long %>% 
                      mutate(value = as.numeric(value)) %>%  
                      group_by(name) %>% 
                      summarise(count = sum(value, na.rm = T)) %>% 
                      arrange(desc(count))

emp_dom_count %>%
  ggplot(., aes(x = reorder(name, +count), y = count, fill = count)) + geom_col(show.legend = FALSE) + 
  coord_flip() +
  theme_minimal() +           
  ylab("Count") + 
  xlab("Empathy Domain")
  

```

### Human or Robot Plot

#### Getting unique measurement method categories

```{r Human or Robot Plot}
hr_long = 
    articles_coded %>%
    summarise(
    year = year,
    country = country,
    robot = paste0(str_count(robot_human, "R")),
    human = paste0(str_count(robot_human, "h"))) %>%
    pivot_longer(., 3:4)


hr_count =  hr_long %>% 
                      mutate(value = as.numeric(value)) %>%  
                      group_by(name) %>% 
                      summarise(count = sum(value, na.rm = T)) %>% 
                      arrange(desc(count))

hr_count %>%
  ggplot(., aes(x = reorder(name, +count), y = count, fill = count)) + geom_col(show.legend = FALSE) + 
  coord_flip() +
  theme_minimal() +           
  ylab("Count") + 
  xlab("Human or Robot")
  

```

```{r Human/robot - Study design plot }
hr_studyDesign <- articles_coded %>% 
      summarise(
      year = year,
      country = country,
      study_design = study_design,
      Robot = paste0(str_count(robot_human, "R")),
      Human = paste0(str_count(robot_human, "h"))) %>%
      pivot_longer(., 4:5) %>% 
      mutate(robot_human = ifelse(value == 1, name, NA)) %>% 
      drop_na() %>% 
      select(1:3, 6) %>% 
      mutate(
      Pain = paste0(str_count(study_design, "Pain")),
      Game = paste0(str_count(study_design, "game")),
      "Social Interaction" = paste0(str_count(study_design, "Social interaction")),
      "Machine Learning" = paste0(str_count(study_design, "Machine learning")),
      VR = paste0(str_count(study_design, "VR")),
      Chatbot = paste0(str_count(study_design, "Chatbot")),
      "Cognitive model" = paste0(str_count(study_design, "Cognitive model")),
      "Behaviour model" = paste0(str_count(study_design, "Behaviour model")),
      "Video stimuli" = paste0(str_count(study_design, "video")),
      "Photo stimuli" = paste0(str_count(study_design, "images"))) %>% 
      pivot_longer(., 5:14) %>% 
      mutate(value = as.numeric(value)) %>% 
      group_by(name, robot_human) %>% 
      summarise(count = sum(value, na.rm = T)) %>% 
      arrange(desc(count)) %>% 
      rename("Study focus" = "robot_human")
  
  hr_studyDesign %>%
    ggplot(., aes(x = reorder(name, +count), y = count, fill = `Study focus`)) + geom_col() + 
    coord_flip() +
    theme_minimal() +           
    ylab("Articles") + 
    scale_fill_manual(values=c("#BD8C58", "#597787")) +
    xlab("Study Design")

```


### Embodiment Plot

#### Getting unique embodiment categories

```{r Getting unique embodiment categories}
unique(articles_coded$embodiment)
```

```{r embodiment Plot}
embodiment_long = 
    articles_coded %>%
    summarise(
    year = year,
    country = country,
    Robot = paste0(str_count(embodiment, "Robot")),
    Videos = paste0(str_count(embodiment, "Videos")),
    VR = paste0(str_count(embodiment, "VR")),
    Avatar = paste0(str_count(embodiment, "Avatar")),
    Text = paste0(str_count(embodiment, "Text")),
    Speech = paste0(str_count(embodiment, "Speech")),
    Virtual_Agent = paste0(str_count(embodiment, "Virtual agent")),
    Virtual_system = paste0(str_count(embodiment, "Virtual system")),
    Smartphone = paste0(str_count(embodiment, "Smartphone")),
    Not_Mentioned = paste0(str_count(embodiment, "Not mentioned"))) %>%
    pivot_longer(., 3:12)


embodiment_count =  embodiment_long %>% 
                      mutate(value = as.numeric(value)) %>%  
                      group_by(name) %>% 
                      summarise(count = sum(value, na.rm = T)) %>% 
                      arrange(desc(count))

embodiment_count %>%
  ggplot(., aes(x = reorder(name, +count), y = count, fill = count)) + geom_col(show.legend = FALSE) + 
  coord_flip() +
  theme_minimal() +           
  ylab("Count") + 
  xlab("Embodiment")
  

```

### Application space Plot

#### Getting unique application space categories

```{r Getting unique application space categories}
unique(articles_coded$app_space)
```

```{r Application space Plot}
app_space_long = 
    articles_coded %>%
    summarise(
    year = year,
    country = country,
    HRI = paste0(str_count(app_space, "HRI")),
    Psychology = paste0(str_count(app_space, "Psychology")),
    Medicine = paste0(str_count(app_space, "Medicine")),
    Therapy = paste0(str_count(app_space, "Therapy")),
    Education = paste0(str_count(app_space, "Education")),
    Machine_Learning = paste0(str_count(app_space, "Machine Learning")),
    Healthcare = paste0(str_count(app_space, "Healthcare")),
    Customer_Service = paste0(str_count(app_space, "Customer Service")),
    Not_Mentioned = paste0(str_count(app_space, "Not mentioned")),
    VR = paste0(str_count(app_space, "VR")),
    NLP = paste0(str_count(app_space, "NLP")),
    game = paste0(str_count(app_space, "game")),
    Counseling = paste0(str_count(app_space, "Counseling")),
    Linguistics = paste0(str_count(app_space, "Linguistics")),
    Computer_vision = paste0(str_count(app_space, "Computer vision"))
    
    
    ) %>%
    pivot_longer(., 3:17)


app_space_count =  app_space_long %>% 
                      mutate(value = as.numeric(value)) %>%  
                      group_by(name) %>% 
                      summarize(count = sum(value, na.rm = T)) %>% 
                      arrange(desc(count))

app_space_count %>%
  ggplot(., aes(x = reorder(name, +count), y = count, fill = count)) + geom_col(show.legend = FALSE) + 
  coord_flip() +
  theme_minimal() +           
  ylab("Count") + 
  xlab("Application Space")
  

```

### Approach Plot

#### Getting unique Approach categories

```{r Getting unique Approach categories}
unique(articles_coded$approach)
```

```{r Approach Plot data wrangling}
approach_long = 
    articles_coded %>%
    summarise(
    year = year,
    country = country,
    GOFAI = paste0(str_count(approach, "GOFAI")),
    Cognitive_model = paste0(str_count(approach, "Cognitive model")),
    Machine_learning = paste0(str_count(approach, "Machine learning")),
    Prerecorded = paste0(str_count(approach, "Prerecorded"))
    ) %>%
    pivot_longer(., 3:6)


approach_count =  approach_long %>% 
                      mutate(value = as.numeric(value)) %>%  
                      group_by(name) %>% 
                      summarise(count = sum(value, na.rm = T)) %>% 
                      arrange(desc(count))

approach_count %>%
  ggplot(., aes(x = reorder(name, +count), y = count, fill = count)) + geom_col(show.legend = FALSE) + 
  coord_flip() +
  theme_minimal() +           
  ylab("Count") + 
  xlab("Approach")
```

```{r}
approach_count_country =  approach_long %>% 
                      mutate(value = as.numeric(value)) %>%  
                      group_by(name, country) %>% 
                      summarise(count = sum(value, na.rm = T)) %>% 
                      arrange(desc(count))


```

### Approach per year plot:

```{r Approach per year plot}
count_year = approach_long %>% 
              mutate(value = as.numeric(value)) %>%  
              group_by(year) %>% 
              summarise(count_year = sum(value))

count_year_app = approach_long %>% 
                  mutate(value = as.numeric(value)) %>%  
                  group_by(year, name) %>% 
                  summarise(count_year_app = sum(value))

count_join = left_join(count_year_app, count_year, by = "year")

count_join = count_join %>% 
             mutate(prop_app = (count_year_app/count_year)*100)

library(viridis)
ggplot(count_join, aes(x=year, y=prop_app, fill=name)) + 
    geom_area() +
    theme_light() +
    geom_area(alpha=0.6 , size=.5, colour="white") +
    scale_fill_viridis(discrete = T) +
    facet_wrap(~name)

ggplot(count_join, aes(x=year, y=prop_app, color = name)) +
    geom_point(alpha=0.7) +
    scale_colour_manual(values=c("#597787", "#AEAE97", "#F4B266", "#BD8C58")) + 
    geom_line() + 
    theme_light()

```
### Approach data for Data Wrapper

```{r Setting up data for Data Wrapper}
approach_datawrapper = 
    articles_coded %>%
    summarise(
    year = year,
    country = country,
    GOFAI = paste0(str_count(approach, "GOFAI")),
    Cognitive_model = paste0(str_count(approach, "Cognitive model")),
    Machine_learning = paste0(str_count(approach, "Machine learning")),
    Prerecorded = paste0(str_count(approach, "Prerecorded"))
    )

app_datawrapper = approach_datawrapper %>% 
                      group_by(year) %>% 
                      mutate(GOFAI = as.numeric(GOFAI),
                             Cognitive_model = as.numeric(Cognitive_model),
                             Machine_learning = as.numeric(Machine_learning),
                             Prerecorded = as.numeric(Prerecorded)
                             ) %>% 
                      summarise(GOFAI = sum(GOFAI),
                                Cognitive_model = sum(Cognitive_model),
                                Machine_learning = sum(Machine_learning),
                                Prerecorded = sum(Prerecorded),
                                )

app_datawrapper <- left_join(app_datawrapper, count_year)

app_datawrapper_prop = app_datawrapper %>% mutate(GOFAI = (GOFAI/count_year)*100, 
                                                  Cognitive_model = (Cognitive_model/count_year)*100,
                                                  Machine_learning = (Machine_learning/count_year)*100,
                                                  Prerecorded = (Prerecorded/count_year)*100)
                                                  
                                                
write_csv(app_datawrapper_prop, "app_datawrapper_prop.csv")

```



### Approach and Empathy Plot

```{r}
emp_app_long <- articles_coded %>% 
    summarise(
    year = year,
    country = country,
    approach = approach,
    "Embodied cues" = paste0(str_count(emp_dom, "Embodied cues")),
    Language = paste0(str_count(emp_dom, "Language")),
    "Social Behavior" = paste0(str_count(emp_dom, "Social behavior")),
    "Facial expression" = paste0(str_count(emp_dom, "Facial expression")),
    Embodiment = paste0(str_count(emp_dom, "Embodiment")),
    Prosociality = paste0(str_count(emp_dom, "Prosociality"))) %>% 
    pivot_longer(., 4:9) %>% 
    mutate(emp_dom = ifelse(value == 1, name, NA)) %>% 
    drop_na() %>% 
    select(1:3, 6) %>% 
    mutate(
    GOFAI = paste0(str_count(approach, "GOFAI")),
    "Cognitive model" = paste0(str_count(approach, "Cognitive model")),
    "Machine learning" = paste0(str_count(approach, "Machine learning")),
    Prerecorded = paste0(str_count(approach, "Prerecorded"))) %>%
    pivot_longer(., 5:8) %>%
    mutate(value = as.numeric(value)) %>%  
    group_by(name, emp_dom) %>% 
    summarise(count = sum(value, na.rm = T)) %>% 
    arrange(desc(count)) %>% 
    rename("Empathy Domain" = "emp_dom")

emp_app_long %>%
  ggplot(., aes(x = reorder(name, +count), y = count, fill = `Empathy Domain`)) + geom_col() + 
  coord_flip() +
  theme_minimal() +           
  ylab("Articles") + 
  scale_fill_manual(values=c("#597787", "#AFD0BF", "#AEAE97", "#DFD5A5", "#F4B266", "#BD8C58")) +
  xlab("Approach")


```

#### Approach plot 2

```{r}
approach_count_facet =  approach_long %>% 
                      mutate(value = as.numeric(value)) %>%  
                      group_by(name, year) %>% 
                      summarise(count = sum(value, na.rm = T)) %>% 
                      arrange(desc(count))
approach_count_facet$year <- as.factor(approach_count_facet$year)

approach_count_facet$year <- factor(approach_count_facet$year, levels = c("2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022"))


approach_count_facet %>%
  group_by(name) %>% 
  ggplot(aes(year, count, fill = name)) +
  geom_col(show.legend = FALSE) + 
  #coord_flip() +
  theme_minimal() +  
  facet_wrap(~name) +
  ylab("Count") + 
  xlab("Approach")
```

### Citations plot

```{r}
p <- articles_coded %>%
  ggplot( aes(x=citations)) +
    geom_histogram(fill = "cornflowerblue", alpha=0.6, position = 'identity') +
    theme_light()

p
```


